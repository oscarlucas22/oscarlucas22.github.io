<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sistema de copias de seguridad | LucasBlog</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="alternate" type="application/atom+xml" href="https://github.com/oscarlucas22/atom.xml" title="LucasBlog Atom Feed">
    <link rel="alternate" type="application/json" href="https://github.com/oscarlucas22/rss.xml" title="LucasBlog JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://github.com/oscarlucas22/rss.xml" title="LucasBlog RSS Feed">
    <meta name="description" content="">
    <meta property="og:url" content="https://github.com/oscarlucas22/practicas/sistemas-cop-seg.html">
    <meta property="og:site_name" content="LucasBlog">
    <meta property="og:title" content="Sistema de copias de seguridad">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta property="article:author" content="Óscar Lucas">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.a9db6349.css" as="style"><link rel="preload" href="/assets/js/app.6a7b100c.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.6c69bdd5.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.711f6750.js" as="script"><link rel="preload" href="/assets/js/page-Sistemadecopiasdeseguridad.a3bac506.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout.e69d9580.js" as="script"><link rel="prefetch" href="/assets/js/55.0311c593.js"><link rel="prefetch" href="/assets/js/56.0cdf8369.js"><link rel="prefetch" href="/assets/js/layout-Blog.8fcf1d1b.js"><link rel="prefetch" href="/assets/js/layout-Layout.4c35ec6e.js"><link rel="prefetch" href="/assets/js/layout-NotFound.546a06ae.js"><link rel="prefetch" href="/assets/js/layout-Slide.a2a41453.js"><link rel="prefetch" href="/assets/js/page--2b761468.295dfd45.js"><link rel="prefetch" href="/assets/js/page--63e03780.fa982eb6.js"><link rel="prefetch" href="/assets/js/page--dfac6430.0a3884f3.js"><link rel="prefetch" href="/assets/js/page-ABD.eaee79db.js"><link rel="prefetch" href="/assets/js/page-ASO.fa60cef0.js"><link rel="prefetch" href="/assets/js/page-Almacenamiento.26d77fca.js"><link rel="prefetch" href="/assets/js/page-Auditoría.084dbbfc.js"><link rel="prefetch" href="/assets/js/page-CompilacióndeunprogramaenCutilizandounMakefile.4e56c4ef.js"><link rel="prefetch" href="/assets/js/page-CopiasdeSeguridadyRestauración.8767bb69.js"><link rel="prefetch" href="/assets/js/page-CortafuegosIDenodoconiptables.12b21eda.js"><link rel="prefetch" href="/assets/js/page-CortafuegosIIPerimetralconnftables.d899eb37.js"><link rel="prefetch" href="/assets/js/page-CriptografíaICifradoasímetrico.2f58d703.js"><link rel="prefetch" href="/assets/js/page-CriptografíaIIICertificadosDigitalesHTTPS.73198f7c.js"><link rel="prefetch" href="/assets/js/page-CriptografíaIIIntegridad,firmasyautenticación.3b11e8a8.js"><link rel="prefetch" href="/assets/js/page-DesplieguedeaplicacionesJava.eb200c49.js"><link rel="prefetch" href="/assets/js/page-Desplieguedeaplicacionespython.e9fd30ad.js"><link rel="prefetch" href="/assets/js/page-Home.0073d838.js"><link rel="prefetch" href="/assets/js/page-IAW.c29f1d69.js"><link rel="prefetch" href="/assets/js/page-ImplantacióndeaplicacioneswebPHPendocker.c59ae6ca.js"><link rel="prefetch" href="/assets/js/page-InformáticaForense.030e408e.js"><link rel="prefetch" href="/assets/js/page-InstalaciónyconfiguracióndeunservidordecorreosenelVPS.2be16b1a.js"><link rel="prefetch" href="/assets/js/page-InstalaciónyconfiguracióninicialdeOpenLDAP.07731f31.js"><link rel="prefetch" href="/assets/js/page-InterconexiónServidores.619d95ea.js"><link rel="prefetch" href="/assets/js/page-Kubernetes.999aba07.js"><link rel="prefetch" href="/assets/js/page-LDAPs.b36ab92f.js"><link rel="prefetch" href="/assets/js/page-LucasBlog.3afa8871.js"><link rel="prefetch" href="/assets/js/page-MariaDBenDebian11Bullseye.d298088d.js"><link rel="prefetch" href="/assets/js/page-MigrarCentos8aRockyLinux8.e014d71a.js"><link rel="prefetch" href="/assets/js/page-MongoDBenDebian11Bullseye.2a4e956b.js"><link rel="prefetch" href="/assets/js/page-Movimientodedatos.8c973fbd.js"><link rel="prefetch" href="/assets/js/page-OracleenDebian11Bullseye.d40aeb7b.js"><link rel="prefetch" href="/assets/js/page-PoblarundirectorioLDAPdesdeunficheroCSV.337c67e8.js"><link rel="prefetch" href="/assets/js/page-PostgreSQLenDebian11Bullseye.0478a8af.js"><link rel="prefetch" href="/assets/js/page-Presentación.667373ea.js"><link rel="prefetch" href="/assets/js/page-ProyectoIntegradofinaldelcurso.672cb72f.js"><link rel="prefetch" href="/assets/js/page-PrácticaEscenarioenOpenStack.dfaad794.js"><link rel="prefetch" href="/assets/js/page-PrácticaICDCconJenkins.591a82f1.js"><link rel="prefetch" href="/assets/js/page-PrácticaImplantacióndeaplicacioneswebPythonendocker.cd948227.js"><link rel="prefetch" href="/assets/js/page-Recoleccióncentralizadadelogsdesistema,mediantejournald.93fe99b0.js"><link rel="prefetch" href="/assets/js/page-SAD.aa13c467.js"><link rel="prefetch" href="/assets/js/page-SRI.c550122f.js"><link rel="prefetch" href="/assets/js/page-ServidoresyClientesdeBasedeDatos.48692f9b.js"><link rel="prefetch" href="/assets/js/page-USUARIOS.27994ca0.js"><link rel="prefetch" href="/assets/js/page-VPN.770373dd.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.76231fd0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a9db6349.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/olucas.png" alt="LucasBlog" class="logo"> <!----> <span class="site-name can-hide">LucasBlog</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Home
</a></div><div class="nav-item"><a href="/presentacion/" class="nav-link"><i class="iconfont icon-people"></i>
  Presentación
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Categorías" class="dropdown-title"><span class="title"><i class="iconfont icon-file"></i>
        Categorías
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/category/ASO.html" class="nav-link"><!---->
  ASO
</a></li><li class="dropdown-item"><a href="/category/ABD.html" class="nav-link"><!---->
  ABD
</a></li><li class="dropdown-item"><a href="/category/SRI.html" class="nav-link"><!---->
  SRI
</a></li><li class="dropdown-item"><a href="/category/SAD.html" class="nav-link"><!---->
  SAD
</a></li><li class="dropdown-item"><a href="/category/IAW.html" class="nav-link"><!---->
  IAW
</a></li></ul></div></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/oscarlucas22" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="/olucas.png" class="avatar round"> <div property="name" class="name">oscarlucas22</div> <meta property="url" content="/"></div> <div class="num-wrapper"><div><div class="num">40</div> <div>Articles</div></div> <div><div class="num">3</div> <div>Category</div></div> <div><div class="num">0</div> <div>Tags</div></div> <div><div class="num">22</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="https://github.com/oscarlucas22" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Home
</a></div><div class="nav-item"><a href="/presentacion/" class="nav-link"><i class="iconfont icon-people"></i>
  Presentación
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="Categorías" class="dropdown-title"><span class="title"><i class="iconfont icon-file"></i>
      Categorías
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/ASO.html" class="nav-link"><!---->
  ASO
</a></li><li class="dropdown-item"><!----> <a href="/category/ABD.html" class="nav-link"><!---->
  ABD
</a></li><li class="dropdown-item"><!----> <a href="/category/SRI.html" class="nav-link"><!---->
  SRI
</a></li><li class="dropdown-item"><!----> <a href="/category/SAD.html" class="nav-link"><!---->
  SAD
</a></li><li class="dropdown-item"><!----> <a href="/category/IAW.html" class="nav-link"><!---->
  IAW
</a></li></ul></div></div> <a rel="noopener noreferrer" href="https://github.com/oscarlucas22" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <!----> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">Sistema de copias de seguridad</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down" categoryPath="/category/$category/" tagPath="/tag/$tag/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">Óscar Lucas</span></span><span aria-label="Page views🔢" data-balloon-pos="down" defaultAuthor="Óscar Lucas" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/practicas/sistemas-cop-seg/" data-flag-title="Sistema de copias de seguridad" class="leancloud_visitors waline-visitor-count"><span class="leancloud-visitors-count">...</span></span></span><!----><span role="navigation" aria-label="Category🌈" data-balloon-pos="down" defaultAuthor="Óscar Lucas" tagPath="/tag/$tag/" class="category-info enable"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon category-icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zm-.854 446.486H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zm446.371-446.486h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zm136.293 813.51H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z" fill="currentColor"></path></svg> <span property="articleSection">Practicas</span></span><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" defaultAuthor="Óscar Lucas" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 12 min</span> <meta property="timeRequired" content="PT12M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/practicas/sistemas-cop-seg/#descripcion" class="anchor-link heading2"><div>Descripción</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="sistema-de-copias-de-seguridad"><a href="#sistema-de-copias-de-seguridad" class="header-anchor">#</a> Sistema de copias de seguridad</h1> <h2 id="descripcion"><a href="#descripcion" class="header-anchor">#</a> Descripción</h2> <p><strong>Implementar un sistema de copias de seguridad para las instancias del cloud, teniendo en cuenta las siguientes características:</strong></p> <ul><li><p><strong>Selecciona una aplicación para realizar el proceso: bacula, amanda, shell script con tar, rsync, dar, afio, etc.</strong></p></li> <li><p><strong>Utiliza una de las instancias como servidor de copias de seguridad, añadiéndole un volumen y almacenando localmente las copias de seguridad que consideres adecuadas en él.</strong></p></li> <li><p><strong>El proceso debe realizarse de forma completamente automática</strong></p></li> <li><p><strong>Selecciona qué información es necesaria guardar (listado de paquetes, ficheros de configuración, documentos, datos, etc.)</strong></p></li> <li><p><strong>Realiza semanalmente una copia completa</strong></p></li> <li><p><strong>Realiza diariamente una copia incremental o diferencial (decidir cual es más adecuada)</strong></p></li> <li><p><strong>Implementa una planificación del almacenamiento de copias de seguridad para una ejecución prevista de varios años, detallando qué copias completas se almacenarán de forma permanente y cuales se irán borrando</strong></p></li> <li><p><strong>Selecciona un directorio de datos &quot;críticos&quot; que deberá almacenarse cifrado en la copia de seguridad, bien encargándote de hacer la copia manualmente o incluyendo la contraseña de cifrado en el sistema</strong></p></li> <li><p><strong>Incluye en la copia los datos de las nuevas aplicaciones que se vayan instalando durante el resto del curso</strong></p></li> <li><p><strong>Utiliza una ubicación secundaria para almacenar las copias de seguridad. Solicita acceso o la instalación de las aplicaciones que sean precisas.</strong></p></li></ul> <p><strong>La corrección consistirá tanto en la restauración puntual de un fichero en cualquier fecha como la restauración completa de una de las instancias la última semana de curso.</strong></p> <hr> <p>Como ya hemos mencionado antes, la máquina que actuará como director (y cliente) será Delta, que es la máquina en el escenario que también actúa como servidor de base de datos (con MariaDB). Así pues, en dicha máquina instalamos los siguientes paquetes (si no tuviéramos ya instalada la base de datos, también habría que instalarla):</p> <div class="language- extra-class"><pre><code>apt install bacula bacula-common-mysql bacula-director-mysql
</code></pre></div><p>Durante la instalación nos aparece el siguiente mensaje, al cual responderemos “Yes” para indicar a bacula que vamos a usar MariaDB/MySQL como gestor de base de datos:</p> <p>Tras esto nos preguntará que contraseña queremos usar para la base de datos de Bacula y finalizará la instalación.</p> <p>Ahora vamos a tener que configurar a “Delta” como director de Bacula, para lo cual tendremos que tocar el fichero de configuración, ubicado en <code>/etc/bacula/bacula-dir.conf</code>. En este fichero hay varios bloques de información, por lo que vamos a ir definiendo un poco cada uno:</p> <div class="language- extra-class"><pre><code>nano /etc/bacula/bacula-dir.conf
</code></pre></div><hr> <div class="language- extra-class"><pre><code>Director {                             
 Name = Delta-dir
 DIRport = 9101                 
 QueryFile = &quot;/etc/bacula/scripts/query.sql&quot;
 WorkingDirectory = &quot;/var/lib/bacula&quot;
 PidDirectory = &quot;/run/bacula&quot;
 Maximum Concurrent Jobs = 20
 Password = &quot;******&quot;          
 Messages = Daemon
 DirAddress = 192.168.0.3
}
</code></pre></div><p>Pasemos al segundo bloque de configuración:</p> <div class="language- extra-class"><pre><code>JobDefs {
 Name = &quot;DefaultJob&quot;
 Type = Backup
 Level = Incremental
 Client = Delta-fd
 FileSet = &quot;Full Set&quot;
 Schedule = &quot;WeeklyCycle&quot;
 Storage = File1
 Messages = Standard
 Pool = File
 SpoolAttributes = yes
 Priority = 10
 Write Bootstrap = &quot;/var/lib/bacula/%c.bsr&quot;
}
</code></pre></div><p>Una vez explicadas cada una de las opciones que aparecen por defecto, vamos a crear tres bloques diferentes de “JobDefs”, uno para cada tipo de copia (diaria, semanal y mensual):</p> <div class="language- extra-class"><pre><code># Copia diaria
JobDefs {
 Name = &quot;CopiaDiaria&quot;
 Type = Backup
 Level = Incremental
 Client = Delta-fd
 FileSet = &quot;Full Set&quot;
 Schedule = &quot;Daily&quot;
 Storage = volcopias
 Messages = Standard
 Pool = Daily
 SpoolAttributes = yes
 Priority = 10
 Write Bootstrap = &quot;/var/lib/bacula/%c.bsr&quot;
}

# Copia semanal
JobDefs {
 Name = &quot;CopiaSemanal&quot;
 Type = Backup
 Level = Full
 Client = Delta-fd
 FileSet = &quot;Full Set&quot;
 Schedule = &quot;Weekly&quot;
 Storage = volcopias
 Messages = Standard
 Pool = Weekly
 SpoolAttributes = yes
 Priority = 10
 Write Bootstrap = &quot;/var/lib/bacula/%c.bsr&quot;
}

# Copia mensual
JobDefs {
 Name = &quot;CopiaMensual&quot;
 Type = Backup
 Level = Full
 Client = Delta-fd
 FileSet = &quot;Full Set&quot;
 Schedule = &quot;Monthly&quot;
 Storage = volcopias
 Messages = Standard
 Pool = Monthly
 SpoolAttributes = yes
 Priority = 10
 Write Bootstrap = &quot;/var/lib/bacula/%c.bsr&quot;
}
</code></pre></div><p>Con esto hemos terminado de definir las plantillas para cada tipo de copia. A continuación tendremos que crear los “Jobs” que harán uso de estas plantillas (y otras que crearemos más adelante). Por cada cliente vamos a crear tres “Jobs” (uno por cada tipo de copia):</p> <div class="language- extra-class"><pre><code># Copias

# Delta
Job {
 Name = &quot;Delta-Diario&quot;
 Client = &quot;delta-fd&quot;
 JobDefs = &quot;CopiaDiaria&quot;
 FileSet= &quot;Delta-Datos&quot;
}

Job {
 Name = &quot;Delta-Semanal&quot;
 Client = &quot;delta-fd&quot;
 JobDefs = &quot;CopiaSemanal&quot;
 FileSet= &quot;Delta-Datos&quot;
}

Job {
 Name = &quot;Delta-Mensual&quot;
 Client = &quot;delta-fd&quot;
 JobDefs = &quot;CopiaMensual&quot;
 FileSet= &quot;Delta-Datos&quot;
}

# Charlie
Job {
 Name = &quot;Charlie-Diario&quot;
 Client = &quot;charlie-fd&quot;
 JobDefs = &quot;CopiaDiaria&quot;
 FileSet= &quot;Charlie-Datos&quot;
}

Job {
 Name = &quot;Charlie-Semanal&quot;
 Client = &quot;charlie-fd&quot;
 JobDefs = &quot;CopiaSemanal&quot;
 FileSet= &quot;Charlie-Datos&quot;
}

Job {
 Name = &quot;Charlie-Mensual&quot;
 Client = &quot;charlie-fd&quot;
 JobDefs = &quot;CopiaMensual&quot;
 FileSet= &quot;Charlie-Datos&quot;
}

# Bravo
Job {
 Name = &quot;Bravo-Diario&quot;
 Client = &quot;bravo-fd&quot;
 JobDefs = &quot;CopiaDiaria&quot;
 FileSet= &quot;Bravo-Datos&quot;
}

Job {
 Name = &quot;Bravo-Semanal&quot;
 Client = &quot;bravo-fd&quot;
 JobDefs = &quot;CopiaSemanal&quot;
 FileSet= &quot;Bravo-Datos&quot;
}

Job {
 Name = &quot;Bravo-Mensual&quot;
 Client = &quot;bravo-fd&quot;
 JobDefs = &quot;CopiaMensual&quot;
 FileSet= &quot;Bravo-Datos&quot;
}

# Alfa
Job {
 Name = &quot;Alfa-Diario&quot;
 Client = &quot;alfa-fd&quot;
 JobDefs = &quot;CopiaDiaria&quot;
 FileSet= &quot;Alfa-Datos&quot;
}

Job {
 Name = &quot;Alfa-Semanal&quot;
 Client = &quot;alfa-fd&quot;
 JobDefs = &quot;CopiaSemanal&quot;
 FileSet= &quot;Alfa-Datos&quot;
}

Job {
 Name = &quot;Alfa-Mensual&quot;
 Client = &quot;alfa-fd&quot;
 JobDefs = &quot;CopiaMensual&quot;
 FileSet= &quot;Alfa-Datos&quot;
}
</code></pre></div><p>Ahora que hemos creado las tareas de realización de las copias de seguridad, tenemos que realizar también las tareas para que se realice la restauración de los datos si fuera necesario:</p> <div class="language- extra-class"><pre><code># Restauración datos

# Delta
Job {
 Name = &quot;DeltaRestore&quot;
 Type = Restore
 Client=delta-fd
 Storage = volcopias
 FileSet=&quot;Delta-Datos&quot;
 Pool = Backup-Restore
 Messages = Standard
}

# Charlie
Job {
 Name = &quot;CharlieRestore&quot;
 Type = Restore
 Client=charlie-fd
 Storage = volcopias
 FileSet=&quot;Charlie-Datos&quot;
 Pool = Backup-Restore
 Messages = Standard
}

# Bravo
Job {
 Name = &quot;Bravolfatore&quot;
 Type = Restore
 Client=bravo-fd
 Storage = volcopias
 FileSet=&quot;Bravo-Datos&quot;
 Pool = Backup-Restore
 Messages = Standard
}

# Alfa
Job {
 Name = &quot;AlfaRestore&quot;
 Type = Restore
 Client=alfa-fd
 Storage = volcopias
 FileSet=&quot;Alfa-Datos&quot;
 Pool = Backup-Restore
 Messages = Standard
}
</code></pre></div><p>Ahora crearemos en el mismo fichero los bloques que harán refencia a los datos que serán copiados, y si estarán comprimidos o no. Crearemos un bloque por cliente, y un bloque general que será usado si no definimos de forma concreta en los “Jobs” que bloque usar:</p> <div class="language- extra-class"><pre><code># Full Set
FileSet {
 Name = &quot;Full Set&quot;
Include {
Options {
    signature = MD5
    compression = GZIP
}
 File = /home
 File = /etc
 File = /var
 File = /usr/share
 File = /usr/local/nagios
}
Exclude {
    File = /var/lib/bacula
    File = /nonexistant/path/to/file/archive/dir
    File = /proc
    File = /etc/fstab
    File = /var/run/systemd/generator
    File = /tmp
    File = /sys
    File = /.journal
    File = /.fsck
}
}

# Alfa
FileSet {
 Name = &quot;Alfa-Datos&quot;
Include {
Options {
    signature = MD5
    compression = GZIP
}
 File = /home
 File = /etc
 File = /var
 File = /usr/share
 File = /usr/local/nagios 
}
Exclude {
 File = /var/lib/bacula
 File = /nonexistant/path/to/file/archive/dir
 File = /proc
 File = /etc/fstab
 File = /var/run/systemd/generator
 File = /var/cache
 File = /var/tmp
 File = /tmp
 File = /sys
 File = /.journal
 File = /.fsck
}
}

# Delta
FileSet {
 Name = &quot;Delta-Datos&quot;
Include {
Options {
    signature = MD5
    compression = GZIP
}
 File = /home
 File = /etc
 File = /var
 File = /opt
 File = /usr/share
 File = /usr/local/nagios
}
Exclude {
 File = /nonexistant/path/to/file/archive/dir
 File = /proc
 File = /var/cache
 File = /var/tmp
 File = /etc/fstab
 File = /var/run/systemd/generator
 File = /tmp
 File = /sys
 File = /.journal
 File = /.fsck
}
}

# Charlie (no he excluido /var/cache ya que Charlie tiene los datos del dns guardados ahí)
FileSet {
 Name = &quot;Charlie-Datos&quot;
Include {
Options {
    signature = MD5
    compression = GZIP
}
 File = /home
 File = /etc
 File = /var
 File = /opt
 File = /usr/share
 File = /usr/local/nagios
}
Exclude {
 File = /var/lib/bacula
 File = /nonexistant/path/to/file/archive/dir
 File = /proc
 File = /etc/fstab
 File = /var/run/systemd/generator
 File = /var/tmp
 File = /tmp
 File = /sys
 File = /.journal
 File = /.fsck
}
}

# Bravo (no he excluido /var/cache ya que Bravo tiene los datos de la pagina web guardados ahí)
FileSet {
 Name = &quot;Bravo-Datos&quot;
Include {
Options {
    signature = MD5
    compression = GZIP
}
 File = /home
 File = /etc
 File = /var
 File = /usr/share
 File = /usr/local/nagios
 File = /run/nagios.lock
}
Exclude {
 File = /var/lib/bacula
 File = /nonexistant/path/to/file/archive/dir
 File = /proc
 File = /etc/fstab
 File = /var/run/systemd/generator
 File = /var/tmp
 File = /tmp
 File = /sys
 File = /.journal
 File = /.fsck
}
}
</code></pre></div><p>Ahora tenemos que crear los bloques “Schedule”, a los que hemos hecho referencia anteriormente, y que definirán cada cuando se realizarán los trabajos:</p> <div class="language- extra-class"><pre><code>Schedule {
 Name = &quot;Daily&quot;
 Run = Level=Incremental Pool=Daily daily at 12:00
}

Schedule {
 Name = &quot;Weekly&quot;
 Run = Level=Full Pool=Weekly mon at 12:00
}

Schedule {
 Name = &quot;Monthly&quot;
 Run = Level=Full Pool=Monthly 1st mon at 12:00
}
</code></pre></div><p>A continuación vamos a definir los bloques “Client”, en los cuales definiremos los datos de los clientes:</p> <div class="language- extra-class"><pre><code># Delta
Client {
 Name = Delta-fd
 Address = 192.168.0.3
 FDPort = 9102
 Catalog = MyCatalog
 Password = &quot;bacula&quot;
 File Retention = 60 days
 Job Retention = 6 months
 AutoPrune = yes
}

# Charlie
Client {
 Name = Charlie-fd
 Address = 192.168.0.2
 FDPort = 9102
 Catalog = MyCatalog
 Password = &quot;bacula&quot;
 File Retention = 60 days
 Job Retention = 6 months
 AutoPrune = yes
}

# Bravo
Client {
 Name = Bravo-fd
 Address = 172.16.0.200
 FDPort = 9102
 Catalog = MyCatalog
 Password = &quot;bacula&quot;
 File Retention = 60 days
 Job Retention = 6 months
 AutoPrune = yes
}

# Alfa
Client {
 Name = Alfa-fd
 Address = 192.168.0.1
 FDPort = 9102
 Catalog = MyCatalog
 Password = &quot;bacula&quot;
 File Retention = 60 days
 Job Retention = 6 months
 AutoPrune = yes
}
</code></pre></div><p>Una vez definidos los clientes, vamos a hacer lo mismo con el bloque “Storage”, en el cuál especificaremos el tipo de almacenamiento que vamos a tener:</p> <div class="language- extra-class"><pre><code>Storage {
 Name = volcopias
 Address = 192.168.0.3
 SDPort = 9103
 Password = &quot;bacula&quot;
 Device = FileChgr1
 Media Type = File
 Maximum Concurrent Jobs = 10
}
</code></pre></div><p>A continuación está el bloque “Catalog”, en el cual simplemente describiremos las credenciales de la base de datos que usaremos:</p> <div class="language- extra-class"><pre><code>Catalog {
 Name = MyCatalog
 dbname = &quot;bacula&quot;; DB Address = &quot;localhost&quot;; DB Port= &quot;3306&quot;; dbuser = &quot;bacula&quot;; dbpassword = &quot;bacula&quot;
}
</code></pre></div><p>Por último, tenemos el bloque “Pool” en este fichero:</p> <div class="language- extra-class"><pre><code>Pool {
 Name = Daily
 Pool Type = Backup
 Recycle = yes
 AutoPrune = yes
 Volume Retention = 8d
}

Pool {
 Name = Weekly
 Pool Type = Backup
 Recycle = yes
 AutoPrune = yes
 Volume Retention = 32d
}

Pool {
 Name = Monthly
 Pool Type = Backup
 Recycle = yes
 AutoPrune = yes
 Volume Retention = 365d
}

Pool {
 Name = Backup-Restore
 Pool Type = Backup
 Recycle = yes
 AutoPrune = yes
 Volume Retention = 366 days
 Maximum Volume Bytes = 50G
 Maximum Volumes = 100
 Label Format = &quot;Remoto&quot;
}
</code></pre></div><p>Con esto hemos finalizado con el fichero <code>/etc/bacula/bacula-dir.conf</code>. Podemos comprobar si hay algún error de configuración ejecutando el siguiente comando:</p> <div class="language- extra-class"><pre><code>bacula-dir -tc /etc/bacula/bacula-dir.conf
</code></pre></div><p>Si no nos indica ningún error podemos continuar. Antes de continuar añadiendo configuración, crear el volumen donde vamos a guardar las copias de seguridad y darle formato. En mi caso, he decidido crear un volumen de 20GB y anexarlo en Delta.</p> <p>![image]</p> <p>Como vemos, aunque el volumen se encuentre anexado, aun no tiene particiones ni tiene formato. Así pues, he decidido crear una única partición en la que se almacenarán las copias y darle un sistema de ficheros “BTRFS”. He elegido este sistema de ficheros ya que se encargará de comprimir automáticamente las copias de seguridad, además de intentar corregir cualquier tipo de corrupción en los ficheros si se diera el caso. También posee otras características que nos serán bastante útiles.</p> <div class="language- extra-class"><pre><code>gdisk /dev/vdb

n

w

y
</code></pre></div><p>Ahora con la partición creada, podemos darle el sistema de ficheros que hemos indicado anteriormente. Para ello, primero instalamos los paquetes necesarios:</p> <div class="language- extra-class"><pre><code>apt install btrfs-progs
</code></pre></div><hr> <div class="language- extra-class"><pre><code>mkfs.btrfs /dev/vdb1
btrfs-progs v5.4.1 
See http://btrfs.wiki.kernel.org for more information.

Label:              (null)
UUID:               17177d8b-3392-4055-9850-f9802452b5ba
Node size:          16384
Sector size:        4096
Filesystem size:    20.00GiB
Block group profiles:
Data:             single            8.00MiB
Metadata:         DUP             256.00MiB
System:           DUP               8.00MiB
SSD detected:       no
Incompat features:  extref, skinny-metadata
Checksum:           crc32c
Number of devices:  1
Devices:
ID        SIZE  PATH
    1    20.00GiB  /dev/vdb1
</code></pre></div><p>Ahora, como nos interesa que el volumen se monte cada vez que el sistema arranque, debemos crear una unidad systemd que se encargue de ello. Para ello, primero vamos a crear el directorio en el que queremos que se monte automáticamente:</p> <div class="language- extra-class"><pre><code>mkdir -p /bacula

chown -R bacula:bacula /bacula/

chmod 755 -R /bacula
</code></pre></div><hr> <div class="language- extra-class"><pre><code>ls -l /
</code></pre></div><p>![image]</p> <p>Ahora creamos la unidad systemd:</p> <div class="language- extra-class"><pre><code>nano /etc/systemd/system/bacula.mount
</code></pre></div><hr> <div class="language- extra-class"><pre><code>[Unit]
Description=Volumen de copias de seguridad   

[Mount]
What=/dev/disk/by-uuid/17177d8b-3392-4055-9850-f9802452b5ba
Where=/bacula  
Type=btrfs
Options=defaults,compress=zlib

[Install]
WantedBy=multi-user.target
</code></pre></div><p>Y lo habilitamos:</p> <div class="language- extra-class"><pre><code>systemctl enable bacula.mount
</code></pre></div><p>Probamos a reinicar ares y comprobar si monta el dispositivo automáticamente:</p> <div class="language- extra-class"><pre><code>reboot
</code></pre></div><hr> <div class="language- extra-class"><pre><code>lsblk -f
</code></pre></div><p>Como vemos lo ha montado correctamente. Ahora crearemos un directorio dentro del volumen en el cual almacenaremos las copias de seguridad:</p> <div class="language- extra-class"><pre><code>mkdir /bacula/backup

chown -R bacula:bacula /bacula/

chmod 755 -R /bacula
</code></pre></div><p>Con el volumen y el directorio creados y listos, podemos pasar a configurar el fichero /etc/bacula/bacula-sd.conf, en el cual definiremos el almacenamiento que usaremos. En este fichero vamos a tener que crear también varios bloques de información, por lo que iremos explicando uno por uno las diferentes opciones que poseen:</p> <div class="language- extra-class"><pre><code>Storage {
 Name = ares-sd
 SDPort = 9103
 WorkingDirectory = &quot;/var/lib/bacula&quot;
 Pid Directory = &quot;/run/bacula&quot;
 Plugin Directory = &quot;/usr/lib/bacula&quot;
 Maximum Concurrent Jobs = 20
 SDAddress = 10.0.1.101
}
</code></pre></div><p>A continuación crearemos dos bloques “Director”, uno para indicar que directores están autorizados a ejecutar el demonio de almacenamiento y otro para indicar los directores que están autorizados a monitorizar el almacenamiento:</p> <div class="language- extra-class"><pre><code>Director {
  Name = ares-dir
  Password = &quot;bacula&quot;
}

Director {
  Name = ares-mon
  Password = &quot;bacula&quot;
  Monitor = yes
}
</code></pre></div><p>Por último, están los bloques “Autochanger” y “Device”, al cual hicimos referencia en el otro fichero, y el cual configuraremos para que guarde las copias de seguridad en el volumen que creamos y montamos anteriormente (la mayoría de parámetros los he dejado por defecto):</p> <div class="language- extra-class"><pre><code>Autochanger {
  Name = FileChgr1
  Device = FileStorage
  Changer Command = &quot;&quot;
  Changer Device = /dev/null
}

Device {
  Name = FileStorage
  Media Type = File
  Archive Device = /bacula/backup
  LabelMedia = yes;
  Random Access = Yes;
  AutomaticMount = yes;
  RemovableMedia = no;
  AlwaysOpen = no;
  Maximum Concurrent Jobs = 5
}
</code></pre></div><p>Ahora que hemos terminado con este fichero, comprobemos que no hay errores usando el siguiente comando:</p> <div class="language- extra-class"><pre><code>bacula-sd -tc /etc/bacula/bacula-sd.conf
</code></pre></div><p>Si no nos indica ningún error podemos continuar. Así pues, reiniciaremos los servicios que hemos configurado para aplicar los cambios, y los habilitaremos si no lo están ya para que se inicien automáticamente en el arranque:</p> <div class="language- extra-class"><pre><code>systemctl restart bacula-sd.service
systemctl enable bacula-sd.service
systemctl restart bacula-director.service
systemctl enable bacula-director.service
</code></pre></div><p>Ahora, en la parte del director solo nos queda configurar un fichero. Ese fichero es /etc/bacula/bconsole.conf, y en él tendremos la configuración para poder acceder a la consola del director. En este fichero solo tenemos que modificar el bloque “Director”, para indicarle que máquina será el director (ella misma):</p> <div class="language- extra-class"><pre><code>Director {
  Name = ares-dir
  DIRport = 9101
  address = 10.0.1.101
  Password = &quot;bacula&quot;
}
</code></pre></div><p>Como ya hemos explicado antes cada uno de esos parámetros, no veo necesario repetirlos. Con esto hemos terminado de configurar el director. Así pues, podemos pasar a configurar los clientes. En cada cliente se repetiran los mismos pasos (salvo en Hera, ya que al ser una máquina con un SO Rocky, tiene incorporado un cortafuegos, por lo que tendremos que abrir los puertos necesarios):</p> <ul><li>En Ares:</li></ul> <p>Como Ares es a la vez director y cliente, tenemos que crear también en él su fichero de configuración de cliente. De esta forma, empezamos por instalar el sofware necesario (que Ares ya lo tiene por ser el director):</p> <div class="language- extra-class"><pre><code>apt install bacula-client
</code></pre></div><p>Habilitamos el servicio para que arranque en cada inicio:</p> <div class="language- extra-class"><pre><code>systemctl enable bacula-fd.service
</code></pre></div><p>Ahora configuraremos el cliente en el fichero <code>/etc/bacula/bacula-fd.conf</code>:</p> <div class="language- extra-class"><pre><code>Director {
  Name = ares-dir
  Password = &quot;bacula&quot;
}

Director {
  Name = ares-mon
  Password = &quot;bacula&quot;
  Monitor = yes
}

FileDaemon {
  Name = ares-fd
  FDport = 9102
  WorkingDirectory = /var/lib/bacula
  Pid Directory = /run/bacula
  Maximum Concurrent Jobs = 20
  Plugin Directory = /usr/lib/bacula
  FDAddress = 10.0.1.101
}

Messages {
  Name = Standard
  director = ares-dir = all, !skipped, !restored
}
</code></pre></div><p>Cada uno de estos parámetros ha sido definido anteriormente, por lo que no veo la necesidad de volver a explicarlos.</p> <p>Reiniciamos el servico para aplicar los cambios y habríamos terminado con este cliente:</p> <div class="language- extra-class"><pre><code>systemctl restart bacula-fd.service
</code></pre></div><ul><li>En Apolo:</li></ul> <p>Al igual que Ares, instalamos los paquetes necesarios:</p> <div class="language- extra-class"><pre><code>apt install bacula-client
</code></pre></div><p>Habilitamos el servicio para que arranque en cada inicio:</p> <div class="language- extra-class"><pre><code>systemctl enable bacula-fd.service
</code></pre></div><p>Configuramos el fichero de cliente (/etc/bacula/bacula-fd.conf):</p> <div class="language- extra-class"><pre><code>Director {
  Name = ares-dir
  Password = &quot;bacula&quot;
}

Director {
  Name = ares-mon
  Password = &quot;bacula&quot;
  Monitor = yes
}

FileDaemon {
  Name = apolo-fd
  FDport = 9102
  WorkingDirectory = /var/lib/bacula
  Pid Directory = /run/bacula
  Maximum Concurrent Jobs = 20
  Plugin Directory = /usr/lib/bacula
  FDAddress = 10.0.1.102
}

Messages {
  Name = Standard
  director = ares-dir = all, !skipped, !restored
}
</code></pre></div><p>Y reiniciamos el servicio para aplicar los cambios:</p> <div class="language- extra-class"><pre><code>systemctl restart bacula-fd.service
</code></pre></div><ul><li>En Zeus:</li></ul> <p>Al igual que antes, instalamos los paquetes necesarios:</p> <div class="language- extra-class"><pre><code>apt install bacula-client
</code></pre></div><p>Habilitamos el servicio para que arranque en cada inicio:</p> <div class="language- extra-class"><pre><code>systemctl enable bacula-fd.service
</code></pre></div><p>Configuramos el fichero de cliente <code>/etc/bacula/bacula-fd.conf</code>:</p> <div class="language- extra-class"><pre><code>Director {
  Name = ares-dir
  Password = &quot;bacula&quot;
}

Director {
  Name = ares-mon
  Password = &quot;bacula&quot;
  Monitor = yes
}

FileDaemon {
  Name = zeus-fd
  FDport = 9102
  WorkingDirectory = /var/lib/bacula
  Pid Directory = /run/bacula
  Maximum Concurrent Jobs = 20
  Plugin Directory = /usr/lib/bacula
  FDAddress = 10.0.1.1
}

Messages {
  Name = Standard
  director = ares-dir = all, !skipped, !restored
}
</code></pre></div><p>Y reiniciamos el servicio para aplicar los cambios:</p> <div class="language- extra-class"><pre><code>systemctl restart bacula-fd.service
</code></pre></div><ul><li>En Hera:</li></ul> <p>Al igual que antes, instalamos los paquetes necesarios:</p> <div class="language- extra-class"><pre><code>dnf install bacula-client
</code></pre></div><p>Habilitamos el servicio para que arranque en cada inicio:</p> <div class="language- extra-class"><pre><code>systemctl enable bacula-fd.service
</code></pre></div><p>Configuramos el fichero de cliente <code>/etc/bacula/bacula-fd.conf</code>:</p> <div class="language- extra-class"><pre><code>Director {
  Name = ares-dir
  Password = &quot;bacula&quot;
}

Director {
  Name = ares-mon
  Password = &quot;bacula&quot;
  Monitor = yes
}

FileDaemon {
  Name = hera-fd
  FDport = 9102
  WorkingDirectory = /var/spool/bacula
  Pid Directory = /var/run
  Maximum Concurrent Jobs = 20
  Plugin Directory = /usr/lib64/bacula
}

Messages {
  Name = Standard
  director = ares-dir = all, !skipped, !restored
}
</code></pre></div><p>Y reiniciamos el servicio para aplicar los cambios:</p> <div class="language- extra-class"><pre><code>systemctl restart bacula-fd.service
</code></pre></div><p>No debemos olvidar, que al ser una máquina Rocky, debemos habilitar en el cortafuegos que trae por defecto los puertos necesarios:</p> <div class="language- extra-class"><pre><code>firewall-cmd --permanent --add-port=9101/tcp

firewall-cmd --permanent --add-port=9102/tcp

firewall-cmd --permanent --add-port=9103/tcp

firewall-cmd --reload
</code></pre></div><p>Con esto hemos terminado en Hera.</p> <p>Con esto ya hemos terminado de configurar todos los clientes. Ahora entremos en la consola del director y veamos si puede conectarse con todas las máquinas (reiniciamos los servicios para que vuelva a intentar conectarse):</p> <div class="language- extra-class"><pre><code>systemctl restart bacula-fd.service
</code></pre></div><hr> <div class="language- extra-class"><pre><code>systemctl restart bacula-sd.service
</code></pre></div><hr> <div class="language- extra-class"><pre><code>systemctl restart bacula-director.service
</code></pre></div><hr> <div class="language- extra-class"><pre><code>bconsole
</code></pre></div><p>![image]</p> <p>Como vemos, ha podido conectarse con todos los clientes, por lo que solo nos queda crear los nodos de almacenamiento donde se guardarán las diferentes copias:</p> <div class="language- extra-class"><pre><code>bconsole
</code></pre></div><p>![image]</p> <p>Pasado un tiempo, se habrán hecho varias copias de seguridad:</p> <div class="language- extra-class"><pre><code>*listjobs
</code></pre></div><p>![image]</p> <p>Como vemos se han creado múltiples copias con el paso de tiempo. Uno de los directorios de los que hemos copia está cifrado. Dentro de zeus, para hacer dicho cifrado, hemos ejecutado lo siguiente:</p> <div class="language- extra-class"><pre><code>gpgtar --encrypt --symmetric --output top-secret.gpg --gpg-args=&quot;--passphrase=secreto --batch&quot; top-secret
</code></pre></div><p>Esto generará un fichero .gpg, qué será guardado junto con las copias de seguridad. Para desencriptarlo, una vez que hayamos restaurado la copia, ejecutamos lo siguiente:</p> <div class="language- extra-class"><pre><code>mkdir nosecreto
</code></pre></div><hr> <div class="language- extra-class"><pre><code>gpgtar --decrypt --directory nosecreto --gpg-args=&quot;--passphrase=secreto --batch&quot; top-secret.gpg
</code></pre></div><p>De esta forma podemos hacer copias y restaurarlas sobre directorios cifrados. Explicado esto, vamos a indicar como restaurar las copias de seguridad usando el director de bacula. Para ello, vamos a restaurar, por ejemplo, a la máquina zeus (antes hemos tenido que configurar las redes y el cliente bacula en zeus). Así pues, entramos en la consola de bacula y ejecutamos lo siguiente:</p> <div class="language- extra-class"><pre><code>*restore client=zeus-fd all
</code></pre></div><p>![image]</p> <p>Hemos puesto <code>all</code> al final del nombre del cliente para indicar que queremos recuperar todos los ficheros. Una vez hecho eso, nos da varias opciones de restauración. En nuestro caso, como suponemos que hemos perdido la máquina origen, elegimos la número 5, que restaurará la copia más reciente:</p> <p>![image]</p> <p>Como antes hemos indicado all al seleccionar el cliente, en este paso podemos indicar done, ya que hemos indicado al principio que queremos restaurar todos los ficheros:</p> <div class="language- extra-class"><pre><code>done
</code></pre></div><p>![image]</p> <p>Ahora elegimos el trabajo de recuperación que queremos usar. Como estamos con zeus, elegiremos el 4:</p> <p>![image]</p> <p>Ya solo debemos indicarle que empiece, y el trabajo se añadirá a la cola y se ejecutará. Pasado un tiempo, el trabajo finalizará:</p> <div class="language- extra-class"><pre><code>*status client=zeus-fd
</code></pre></div><p>![image]</p> <p>Una vez que hemos finalizado aquí, en la máquina destino ya estarían todos los ficheros que hemos restaurado, incluyendo la configuración de los servicios. Como hemos guardado la lista de paquetes instalados (al haber hecho copia del directorio /var), para reinstalar todos los paquetes ejecutamos lo siguiente:</p> <div class="language- extra-class"><pre><code>apt reinstall ~i
</code></pre></div><p>Si fuera hera, el comando sería el siguiente:</p> <div class="language- extra-class"><pre><code>dnf reinstall \*
</code></pre></div><p>Tras un tiempo, todos los paquetes se habrán instalado otra vez y tras un reinicio, la máquina volverá a estar completamente operativa. Los pasos a seguir serían los mismos en Hera y Apolo, con la excepción de que en Apolo, la configuración de LDAP no se guarda correctamente, por lo que en la copia he exportado la configuración manualmente:</p> <div class="language- extra-class"><pre><code>slapcat -n 0 -l config_slapd.ldif
</code></pre></div><p>Dicho fichero contiene toda la configuración de LDAP, por lo que al restaurar Apolo, solo tendremos que reinsertar la configuración a mano y reiniciar el servicio. Con esto podemos dar por finalizada la explicación de como realizar las copias y restaurarlas. Sin embargo, queda la problemática del almacenamiento de las copias a largo plazo. Actualmente tenemos hechas muchas copias, ya la mayoría son muy parecidas, ya que no hemos implementado nuevas funciones en nuestro escenario. No obstante, y con una previsión de futuro, habrá que guardar de forma permanente algunas copias, para poder restaurar el escenario si es necesario. Las copias que se guardarán de forma permanente serán aquellas que se realicen tras una implementación de un nuevo servicio en el escenario, además de una copia completa cada 3 meses que se guardará de forma permanente, para que podamos recuperar los datos de las aplicaciones de forma trimestral.</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/oscarlucas22/edit/main/practicas/sistemas-cop-seg.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <!----> <!----></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.6a7b100c.js" defer></script><script src="/assets/js/vendors~layout-Layout.6c69bdd5.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.711f6750.js" defer></script><script src="/assets/js/page-Sistemadecopiasdeseguridad.a3bac506.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout.e69d9580.js" defer></script>
  </body>
</html>
