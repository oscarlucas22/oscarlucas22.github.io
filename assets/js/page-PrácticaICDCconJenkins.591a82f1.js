(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{1135:function(e,a,n){"use strict";n.r(a);var r=n(1),i=Object(r.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"practica-ic-dc-con-jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#practica-ic-dc-con-jenkins"}},[e._v("#")]),e._v(" Práctica: IC/DC con Jenkins")]),e._v(" "),a("p",[a("strong",[e._v("El objetivo de esta práctica es el desarrollo gradual de un Pipeline que vaya realizando tareas sobre el repositorio de una aplicación.")])]),e._v(" "),a("p",[a("strong",[e._v("La aplicación con la que vamos a trabajar será tu fork de la aplicación django Polls. Como hemos visto esta aplicación que implementa el tutorial de Django tiene implementado un módulo de pruebas.")])]),e._v(" "),a("p",[a("strong",[e._v("Vamos a construir el Pipeline en varias fases:")])]),e._v(" "),a("h2",{attrs:{id:"ejercicio-1-construccion-de-una-imagen-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ejercicio-1-construccion-de-una-imagen-docker"}},[e._v("#")]),e._v(" Ejercicio 1: Construcción de una imagen docker")]),e._v(" "),a("p",[a("strong",[e._v("Partimos del pipeline que hemos desarrollado en el "),a("a",{attrs:{href:"https://fp.josedomingo.org/iaw2223/7_ic/t3.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Taller 3: Integración continua de aplicación django (Test)"),a("OutboundLink")],1),e._v(", donde hemos automatizado el test de la aplicación.")])]),e._v(" "),a("p",[a("strong",[e._v("Modifica el pipeline para que después de hacer el test sobre la aplicación, genere una imagen docker. tienes que tener en cuenta que los pasos para generar la imagen lo tienes que realizar en la máquina donde está instalado Jenkins. Tendrás que añadir las siguientes acciones:")])]),e._v(" "),a("ol",[a("li",[a("p",[a("strong",[e._v("Construir la imagen con el Dockerfile que tengas en el repositorio.")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Subir la imagen a tu cuenta de Docker Hub.")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Borrar la imagen que se ha creado.")])])])]),e._v(" "),a("p",[a("strong",[e._v("Por lo tanto tienes que estudiar el apartado "),a("a",{attrs:{href:"https://fp.josedomingo.org/iaw2223/7_ic/jenkins/runner.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ejecución de un pipeline en varios runner"),a("OutboundLink")],1),e._v(" para ejecutar el pipeline en dos runner:")])]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("En el contenedor docker a partir de la imagen python:3 los pasos del taller 3.")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("En la máquina de Jenkins los pasos de este ejercicio.")])])])]),e._v(" "),a("p",[a("strong",[e._v("Otras consideraciones:")])]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("Cuando termine de ejecutar el pipeline te mandará un correo de notificación.")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("El pipeline se guardará en un fichero Jenkinsfile en tu repositorio, y la configuración del pipeline hará referencia a él.")])])])]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("Vamos a comenzar a crear un pipeline, que realice las siguientes tareas:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Clone el repositorio.")])]),e._v(" "),a("li",[a("p",[e._v("Instale los requerimientos python.")])]),e._v(" "),a("li",[a("p",[e._v("Realice los tests al programa.")])])]),e._v(" "),a("p",[e._v("Este pipeline se tiene que ejecutar sobre la imagen python:3. Otras consideraciones:")]),e._v(" "),a("ul",[a("li",[e._v("Este pipeline se disparará cuando observe un cambio en el repositorio. Esta comprobación se hará cada minuto.")])]),e._v(" "),a("p",[e._v("Para ello creamos en Jenkins el siguiente pipeline:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("pipeline {\n    agent {\n        docker { image 'python:3'\n        args '-u root:root'\n        }\n    }\n    stages {\n        stage('Clone') {\n            steps {\n                git branch:'main',url:'https://github.com/oscarlucas22/django_tutorial_docker.git'\n            }\n        }\n        stage('Install') {\n            steps {\n                sh 'pip install -r requirements.txt'\n            }\n        }\n        stage('Test')\n        {\n            steps {\n                sh 'python3 manage.py test'\n            }\n        }\n    }\n}\n")])])]),a("hr"),e._v(" "),a("h2",{attrs:{id:"ejercicio-2-despliegue-de-la-aplicacion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ejercicio-2-despliegue-de-la-aplicacion"}},[e._v("#")]),e._v(" Ejercicio 2: Despliegue de la aplicación")]),e._v(" "),a("p",[a("strong",[e._v("Amplía el pipeline anterior para que tenga una última etapa donde se haga el despliegue de la imagen que se ha subido a Docker Hub en tu entorno de producción (VPS). Algunas pistas:")])]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("Busca información de cómo hacer el despliegue a un servidor remoto (ssh, buscando algún plugin con esa funcionalidad,…)")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Si vas a hacer conexiones por ssh, tendrás que guardar una credencial en tu Jenkins con el nombre de usuario y contraseña.")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Para el despliegue deberá usar el fichero docker-compose.yaml que has generado en otras prácticas.")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Se deberá borrar el contenedor con la versión anterior, descargar la nueva imagen y crear un nuevo contenedor.")])])])]),e._v(" "),a("p",[a("strong",[e._v("Otras consideraciones:")])]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("Cambia el disparador del pipeline. Configúralo con un webhook de github, para que cada vez que se produce un push se ejecute el pipeline. Para que el webhook pueda acceder a tu Jenkins puedes usar "),a("a",{attrs:{href:"https://ngrok.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ngrok"),a("OutboundLink")],1),e._v(".")])])]),e._v(" "),a("hr")])}),[],!1,null,null,null);a.default=i.exports}}]);